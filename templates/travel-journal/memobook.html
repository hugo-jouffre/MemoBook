<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>{{ book_title }}</title>
</head>
<body class="mbk-book">
  <!-- ========== COUVERTURE ========== -->
  <section class="mbk-cover">
    <div class="mbk-cover-img">
      <img src="{{ cover_photo }}" alt="Couverture" />
    </div>

    <div class="mbk-cover-content">
      <!-- Haut de page : titre + sous-titre -->
      <div class="mbk-cover-top">
        <h1 class="mbk-cover-title">{{ book_title }}</h1>
        {% if book_subtitle %}
          <h2 class="mbk-cover-subtitle">{{ book_subtitle }}</h2>
        {% endif %}
      </div>

      <!-- Bas de page : auteurs + dates -->
      <div class="mbk-cover-bottom">
        {% if authors %}
          <p class="mbk-cover-authors">{{ authors }}</p>
        {% endif %}
        {% if date_range %}
          <p class="mbk-cover-dates">{{ date_range }}</p>
        {% endif %}
      </div>
    </div>
  </section>

  <!-- Stats globales optionnelles -->
  {% if global_stats %}
    <section class="mbk-stats">
      <h2 class="mbk-stats-title">Le voyage en un coup dâ€™Å“il</h2>
      <div class="mbk-stats-grid">
        {% if global_stats.total_days %}
          <div class="mbk-stat-item">
            <div class="mbk-stat-value">{{ global_stats.total_days }}</div>
            <div class="mbk-stat-label">Jours</div>
          </div>
        {% endif %}
        {% if global_stats.countries %}
          <div class="mbk-stat-item">
            <div class="mbk-stat-value">{{ global_stats.countries }}</div>
            <div class="mbk-stat-label">Pays visitÃ©s</div>
          </div>
        {% endif %}
        {% if global_stats.cities %}
          <div class="mbk-stat-item">
            <div class="mbk-stat-value">{{ global_stats.cities }}</div>
            <div class="mbk-stat-label">Villes</div>
          </div>
        {% endif %}
        {% if global_stats.km_total %}
          <div class="mbk-stat-item">
            <div class="mbk-stat-value">{{ global_stats.km_total }}</div>
            <div class="mbk-stat-label">KilomÃ¨tres</div>
          </div>
        {% endif %}
        {% if global_stats.km_walked %}
          <div class="mbk-stat-item">
            <div class="mbk-stat-value">{{ global_stats.km_walked }}</div>
            <div class="mbk-stat-label">Km Ã  pied</div>
          </div>
        {% endif %}
        {% if global_stats.flights %}
          <div class="mbk-stat-item">
            <div class="mbk-stat-value">{{ global_stats.flights }}</div>
            <div class="mbk-stat-label">Vols</div>
          </div>
        {% endif %}
        {% if global_stats.trains %}
          <div class="mbk-stat-item">
            <div class="mbk-stat-value">{{ global_stats.trains }}</div>
            <div class="mbk-stat-label">Trains</div>
          </div>
        {% endif %}
        {% if global_stats.hotels %}
          <div class="mbk-stat-item">
            <div class="mbk-stat-value">{{ global_stats.hotels }}</div>
            <div class="mbk-stat-label">HÃ©bergements</div>
          </div>
        {% endif %}
        {% if global_stats.drinks %}
          <div class="mbk-stat-item">
            <div class="mbk-stat-value">{{ global_stats.drinks }}</div>
            <div class="mbk-stat-label">Boissons</div>
          </div>
        {% endif %}
      </div>
    </section>
  {% endif %}

  <!-- Saut de page aprÃ¨s la couverture + stats -->
  <div class="mbk-page-break"></div>

  <!-- ========== PAGES JOUR PAR JOUR ========== -->
  {% for day in days %}
    <section class="mbk-day">
      {% if day.sticker_groups or day.sticker_1 or day.sticker_2 %}
        <div class="mbk-sticker-groups">
          {% if day.sticker_groups %}
            {% for group in day.sticker_groups %}
              <div class="mbk-sticker-group mbk-sticker-group--{{ group.position | default('top-right') }}" style="--mbk-group-rotation: {{ group.rotation | default(0) }}deg;">
                {% for sticker in group.stickers %}
                  <span class="mbk-sticker-placeholder mbk-sticker-placeholder--{{ sticker.style | default('stamp') }} {{ loop.cycle('mbk-tilt-left', 'mbk-tilt-right') }}" {% if sticker.accent_color %}style="--mbk-sticker-accent: {{ sticker.accent_color }};"{% endif %}>
                    {{ sticker.text }}
                  </span>
                {% endfor %}
              </div>
            {% endfor %}
          {% endif %}

          {% if day.sticker_1 or day.sticker_2 %}
            <div class="mbk-sticker-group mbk-sticker-group--top-right">
              {% if day.sticker_1 %}
                <img class="mbk-sticker-image" src="{{ day.sticker_1 }}" alt="Sticker 1" />
              {% endif %}
              {% if day.sticker_2 %}
                <img class="mbk-sticker-image" src="{{ day.sticker_2 }}" alt="Sticker 2" />
              {% endif %}
            </div>
          {% endif %}
        </div>
      {% endif %}

      <!-- En-tÃªte de jour -->
      <div class="mbk-day-header">
        <h2 class="mbk-day-title">{{ day.title }}</h2>
        <div class="mbk-day-meta">
          {% if day.date %}
            <span class="mbk-day-meta-item">{{ day.date }}</span>
          {% endif %}
          {% if day.city %}
            <span class="mbk-day-meta-item">
              {{ day.city }}{% if day.country %}, {{ day.country }}{% endif %}
            </span>
          {% endif %}
        </div>
      </div>

      {% if day.day_intro %}
        <section class="mbk-day-intro">
          <div class="mbk-day-intro-left">
            <div class="mbk-day-pill">
              <span class="mbk-day-pill-label">Jour</span>
              <span class="mbk-day-pill-value">{{ day.day_intro.day_number | default(loop.index) }}</span>
            </div>
            <div class="mbk-day-intro-texts">
              {% if day.day_intro.date or day.date %}
                <p class="mbk-day-intro-date">{{ day.day_intro.date | default(day.date) }}</p>
              {% endif %}
              {% if day.day_intro.location or day.city %}
                <p class="mbk-day-intro-location">{{ day.day_intro.location | default(day.city) }}</p>
              {% endif %}
            </div>
          </div>
          <div class="mbk-day-intro-right">
            {% if day.day_intro.weather_icon or day.day_intro.weather_summary or day.day_intro.temperature %}
              <div class="mbk-weather">
                {% if day.day_intro.weather_icon %}
                  <span class="mbk-weather-icon">{{ day.day_intro.weather_icon }}</span>
                {% endif %}
                <div>
                  {% if day.day_intro.weather_summary %}
                    <p class="mbk-weather-summary">{{ day.day_intro.weather_summary }}</p>
                  {% endif %}
                  {% if day.day_intro.temperature %}
                    <p class="mbk-weather-temp">{{ day.day_intro.temperature }}</p>
                  {% endif %}
                </div>
              </div>
            {% endif %}
            {% if day.day_intro.mood %}
              <p class="mbk-day-intro-mood">{{ day.day_intro.mood }}</p>
            {% endif %}
          </div>
        </section>
      {% endif %}

      <!-- Layout 1 : hero photo en haut + texte dessous -->
      {% if day.layout_hero_top %}
        <div class="mbk-layout mbk-layout-hero">
          {% if day.photos and day.photos|length > 0 %}
            <figure class="mbk-hero mbk-tilt-right">
              <div class="mbk-img-wrap mbk-img-hero">
                <img src="{{ day.photos[0] }}" alt="Photo principale" />
              </div>
              <span class="mbk-tape mbk-tape-left"></span>
            </figure>
          {% endif %}

          <div class="mbk-text-block">
            {{ day.body_html | safe }}
          </div>
        </div>
      {% endif %}

      <!-- Layout 2 : texte Ã  gauche / mosaÃ¯que Ã  droite -->
      {% if day.layout_split_left %}
        <div class="mbk-layout mbk-layout-split">
          <div class="mbk-text-block">
            {{ day.body_html | safe }}
          </div>

          {% if day.photos %}
          <div class="mbk-gallery">
            {% for photo in day.photos %}
              <figure class="mbk-card {% if loop.index is odd %}mbk-tilt-left{% else %}mbk-tilt-right{% endif %}">
                <div class="mbk-img-wrap mbk-img-split">
                  <img src="{{ photo }}" alt="Photo {{ loop.index }}" />
                </div>
              </figure>
            {% endfor %}
          </div>
          {% endif %}
        </div>
      {% endif %}

      <!-- Layout 3 : texte + fun facts encartÃ©s -->
      {% if day.layout_story_facts %}
        <div class="mbk-layout mbk-layout-facts">
          <div class="mbk-text-block">
            {{ day.body_html | safe }}
          </div>

          {% if day.fun_facts %}
            <section class="mbk-facts keep-together">
              <h3 class="mbk-chip">
                ðŸ’¡ {% if day.city %}{{ day.city }}{% else %}{{ day.country }}{% endif %} â€“ Fun Facts
              </h3>
              <ul class="mbk-facts-list">
                {% for fact in day.fun_facts %}
                  <li>{{ fact }}</li>
                {% endfor %}
              </ul>
            </section>
          {% endif %}
        </div>
      {% endif %}

      <!-- Layout 4 : collage / canvas -->
      {% if day.layout_collage %}
        <div class="mbk-canvas">

          <!-- bloc texte principal -->
          <article class="mbk-card-floating mbk-card-text">
            {{ day.body_html | safe }}
          </article>

          <!-- fun facts -->
          {% if day.fun_facts %}
          <article class="mbk-card-floating mbk-card-facts">
            <h3 class="mbk-chip">
              ðŸ’¡ {% if day.city %}{{ day.city }}{% else %}{{ day.country }}{% endif %} â€“ Fun Facts
            </h3>
            <ul class="mbk-facts-list">
              {% for fact in day.fun_facts %}
                <li>{{ fact }}</li>
              {% endfor %}
            </ul>
          </article>
          {% endif %}

          <!-- photos (derniÃ¨re en pleine largeur) -->
          {% if day.photos %}
            {% for photo in day.photos %}
            <figure class="mbk-card-floating mbk-card-photo {% if loop.last and day.photos|length > 1 %}mbk-card-photo-wide{% endif %}">
              <div class="mbk-img-wrap {% if loop.last and day.photos|length > 1 %}mbk-img-wide{% else %}mbk-img-collage{% endif %}">
                <img src="{{ photo }}" alt="Photo {{ loop.index }}" />
              </div>
            </figure>
            {% endfor %}
          {% endif %}

        </div>
      {% endif %}

      <!-- Layout 5 : full opener pour lancer un jour -->
      {% if day.layout_story_opener %}
        <div class="mbk-layout mbk-layout-opener">
          <article class="mbk-opener-text">
            {% if day.opener_kicker %}
              <p class="mbk-opener-kicker">{{ day.opener_kicker }}</p>
            {% endif %}
            {{ (day.opener_body_html or day.body_html) | safe }}
          </article>

          {% if day.opener_photos %}
            <div class="mbk-opener-photos">
              {% for photo in day.opener_photos %}
                <figure class="mbk-opener-photo mbk-opener-photo-{{ loop.index }}">
                  <div class="mbk-img-wrap mbk-img-opener">
                    <img src="{{ photo }}" alt="Photo d'ouverture {{ loop.index }}" />
                  </div>
                </figure>
              {% endfor %}
            </div>
          {% endif %}
        </div>
      {% endif %}

      <!-- Moments clÃ©s -->
      {% if day.highlights %}
        <section class="mbk-highlight keep-together">
          <h3>Moments clÃ©s</h3>
          <ul>
            {% for h in day.highlights %}
              <li>{{ h }}</li>
            {% endfor %}
          </ul>
        </section>
      {% endif %}

      <!-- Ligne de voyage dÃ©corative -->
      <svg class="mbk-path" viewBox="0 0 1443 150" preserveAspectRatio="none">
        <path d="M0.414473 78.9794C87.4939 47.3142 227.565 42.7691 287.662 62.3066C362.785 86.7284 516.227 88.6438 581.759 75.2357C647.292 61.8277 641.998 -18.0781 552.16 5.41776C462.323 28.9137 617.12 138.101 758.095 92.491C899.07 46.8813 875.062 125.662 1040.05 125.662C1205.03 125.662 1185.76 73.6032 1442.94 53.2503"
              stroke="#B86D18"
              stroke-width="2.42575"
              stroke-dasharray="9.7 9.7" />
      </svg>
    </section>

    <!-- Saut de page entre les jours (mais pas aprÃ¨s le dernier) -->
    {% if not loop.last %}
      <div class="mbk-page-break"></div>
    {% endif %}
  {% endfor %}

  {% if back_cover %}
    <div class="mbk-page-break"></div>
    <section class="mbk-back-cover">
      <div class="mbk-back-photo"{% if back_cover.image %} style="background-image: url('{{ back_cover.image }}');"{% endif %}>
        <div class="mbk-back-overlay">
          <img class="mbk-back-logo" src="{{ back_cover.logo_url | default('https://cdn.prod.website-files.com/68827087b5bebc3702bf1a54/691af5f6d5f78fd098aef055_Logo%20MemoBook%20-%20White.svg') }}" alt="Logo MemoBook" />
          <div class="mbk-back-content">
            {% if back_cover.closing_text %}
              <p class="mbk-back-title">{{ back_cover.closing_text }}</p>
            {% endif %}
            {% if back_cover.closing_subtext %}
              <p class="mbk-back-subtext">{{ back_cover.closing_subtext }}</p>
            {% endif %}
            {% if back_cover.cta %}
              <p class="mbk-back-cta">{{ back_cover.cta }}</p>
            {% endif %}
          </div>
        </div>
      </div>
    </section>
  {% endif %}
</body>
</html>
